# xdirex - Smart Redirect System

> **Cloudflare-first Smart Redirect System with Admin Dashboard**  
> à¹€à¸™à¹‰à¸™à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¸ªà¸¹à¸‡, à¸Ÿà¸£à¸µ, à¸£à¸­à¸‡à¸£à¸±à¸š redirect à¸ˆà¸³à¸™à¸§à¸™à¸¡à¸²à¸ à¸à¸£à¹‰à¸­à¸¡ Conversion Tracking

[![Deploy to Cloudflare](https://deploy.workers.cloudflare.com/button)](https://deploy.workers.cloudflare.com/?url=https://github.com/YOUR_USERNAME/xdirex)

## âœ¨ Features

- ğŸš€ **à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¸ªà¸¹à¸‡** - Cloudflare Edge Network
- ğŸ†“ **à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸Ÿà¸£à¸µ** - Cloudflare Free Tier
- ğŸ”— **Multi-Link Management** - à¸ˆà¸±à¸”à¸à¸²à¸£à¸¥à¸´à¹‰à¸‡à¸à¹Œà¸«à¸¥à¸±à¸à¹„à¸”à¹‰à¸«à¸¥à¸²à¸¢à¸­à¸±à¸™
- ğŸ¯ **Smart Redirect** - Round-robin à¹à¸¥à¸° Random mode
- ğŸ“Š **Conversion Tracking** - à¸•à¸´à¸”à¸•à¸²à¸¡ conversion à¹à¸šà¸š real-time
- ğŸ¨ **Icon Customization** - à¹€à¸¥à¸·à¸­à¸à¹„à¸­à¸„à¸­à¸™à¹„à¸”à¹‰ 8 à¹à¸šà¸š
- ğŸ” **Google OAuth** - à¸¥à¹‡à¸­à¸à¸­à¸´à¸™à¸”à¹‰à¸§à¸¢ Google
- ğŸ’¾ **Cloudflare D1** - SQLite database
- âš¡ **Cloudflare KV** - Ultra-fast caching

## ğŸ—ï¸ Tech Stack

- **Frontend**: HTML + Vanilla JavaScript + CSS
- **Backend**: Cloudflare Workers
- **Database**: Cloudflare D1 (SQLite)
- **Cache**: Cloudflare KV
- **Auth**: Google OAuth 2.0 + JWT
- **Hosting**: Cloudflare Pages

## ğŸ“¦ Project Structure

```
xdirex/
â”œâ”€â”€ public/                 # Frontend files
â”‚   â”œâ”€â”€ index.html         # Main dashboard
â”‚   â”œâ”€â”€ login.html         # Login page
â”‚   â””â”€â”€ assets/
â”‚       â”œâ”€â”€ app.js         # Main application logic
â”‚       â”œâ”€â”€ api.js         # API client
â”‚       â”œâ”€â”€ auth.js        # Auth helpers
â”‚       â”œâ”€â”€ style.css      # Styles
â”‚       â””â”€â”€ favicon_io/    # Favicons
â”œâ”€â”€ worker/                # Cloudflare Workers
â”‚   â”œâ”€â”€ index.js          # Main routing
â”‚   â”œâ”€â”€ auth.js           # OAuth & JWT
â”‚   â”œâ”€â”€ redirect.js       # Redirect logic
â”‚   â”œâ”€â”€ conversion.js     # Conversion tracking
â”‚   â””â”€â”€ utils.js          # Utilities
â”œâ”€â”€ migrations/           # D1 migrations
â”œâ”€â”€ schema.sql           # Database schema
â”œâ”€â”€ wrangler.toml        # Cloudflare config
â””â”€â”€ README.md
```

## ğŸš€ Quick Start

### Prerequisites

- [Node.js](https://nodejs.org/) (v18+)
- [Cloudflare account](https://dash.cloudflare.com/sign-up)
- [Wrangler CLI](https://developers.cloudflare.com/workers/wrangler/install-and-update/)
- [Google OAuth Credentials](https://console.cloud.google.com/)

### Installation

1. **Clone repository**
```bash
git clone https://github.com/YOUR_USERNAME/xdirex.git
cd xdirex
```

2. **Install Wrangler**
```bash
npm install -g wrangler
wrangler login
```

3. **Create D1 Database**
```bash
wrangler d1 create xdirex_db
```
Copy the database ID to `wrangler.toml`

4. **Create KV Namespace**
```bash
wrangler kv:namespace create REDIRECT_KV
```
Copy the ID to `wrangler.toml`

5. **Run Migrations**
```bash
wrangler d1 execute xdirex_db --remote --file=schema.sql
wrangler d1 execute xdirex_db --remote --file=migrations/001_add_max_links_and_branding.sql
wrangler d1 execute xdirex_db --remote --file=migrations/002_change_default_mode.sql
wrangler d1 execute xdirex_db --remote --file=migrations/003_fix_main_link_slug_unique.sql
wrangler d1 execute xdirex_db --remote --file=migrations/004_add_contact_url.sql
```

6. **Set up Google OAuth**
- Go to [Google Cloud Console](https://console.cloud.google.com/)
- Create OAuth 2.0 credentials
- Add authorized redirect URI: `https://YOUR_DOMAIN/api/auth/callback`
- Copy Client ID and Client Secret

7. **Set Secrets**
```bash
wrangler secret put GOOGLE_CLIENT_ID
wrangler secret put GOOGLE_CLIENT_SECRET
wrangler secret put JWT_SECRET
```

8. **Deploy**
```bash
wrangler pages deploy public --project-name=xdirex
```

## ğŸ“– Usage

### Creating Main Link

1. Login with Google
2. Click "à¸ªà¸£à¹‰à¸²à¸‡ Main Link"
3. Enter slug (e.g., `my-campaign`)
4. Choose icon
5. Click "à¸ªà¸£à¹‰à¸²à¸‡"

### Adding Destinations

1. Click "Destinations" button on main link card
2. Click "à¹€à¸à¸´à¹ˆà¸¡ Destination"
3. Enter slug and URL
4. Click "à¹€à¸à¸´à¹ˆà¸¡"

### Setting up Conversion Tracking

1. Click âš™ï¸ icon on destination link
2. Enter:
   - **Key name**: Field name (e.g., `status`)
   - **Success value**: Success value (e.g., `success`)
3. On your landing page, send POST request:

```javascript
fetch('https://your-domain.com/api/conversion', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    slug: 'campaign-a',
    data: { status: 'success' }
  })
});
```

## ğŸ”§ Configuration

### wrangler.toml

```toml
name = "xdirex"
compatibility_date = "2024-01-01"

[[d1_databases]]
binding = "DB"
database_name = "xdirex_db"
database_id = "YOUR_DATABASE_ID"

[[kv_namespaces]]
binding = "REDIRECT_KV"
id = "YOUR_KV_ID"
```

### Environment Variables

- `GOOGLE_CLIENT_ID` - Google OAuth Client ID
- `GOOGLE_CLIENT_SECRET` - Google OAuth Client Secret
- `JWT_SECRET` - JWT signing secret

## ğŸ“Š Database Schema

### Tables

- **users** - User accounts with max_links limit
- **main_links** - Main redirect links
- **destination_links** - Destination URLs
- **conversion_settings** - Conversion tracking settings
- **round_robin_state** - Round-robin state
- **branding** - Footer branding

## ğŸ¯ Redirect Modes

### Round-robin
Rotates through destinations sequentially

### Random
Randomly selects destination each time

## ğŸ”— API Endpoints

### Authentication
- `GET /api/auth/login` - Google OAuth login
- `GET /api/auth/callback` - OAuth callback
- `GET /api/auth/me` - Get current user
- `POST /api/auth/logout` - Logout

### Main Links
- `GET /api/main-links` - Get all main links
- `POST /api/main-links` - Create main link
- `PUT /api/main-links/:id` - Update main link
- `DELETE /api/main-links/:id` - Delete main link

### Destinations
- `GET /api/destinations/:mainLinkId` - Get destinations
- `POST /api/destinations` - Create destination
- `PUT /api/destinations/:id` - Update destination
- `DELETE /api/destinations/:id` - Delete destination

### Conversion
- `POST /api/conversion` - Track conversion
- `POST /api/conversion/settings` - Set conversion settings

### Redirect
- `GET /:userSlug?go=:mainSlug` - Smart redirect

## ğŸ¨ Customization

### Icons
8 Lucide icons available:
- link, zap, target, star, heart, gift, shopping-cart, trophy

### Branding
Update branding in D1 database:
```sql
UPDATE branding 
SET label = 'Your Brand', 
    url = 'https://your-site.com',
    contact_url = 'https://your-contact.com'
WHERE id = 1;
```

## ğŸ› Troubleshooting

### OAuth not working
- Check redirect URIs in Google Cloud Console
- Verify CLIENT_ID and CLIENT_SECRET
- Check cookie domain settings

### Database errors
- Run all migrations in order
- Check D1 database binding in wrangler.toml

### KV not updating
- Check KV namespace binding
- Clear KV cache if needed

## ğŸ“ License

MIT License - feel free to use for personal or commercial projects

## ğŸ¤ Contributing

Contributions welcome! Please open an issue or PR.

## ğŸ“§ Contact

- GitHub: [@YOUR_USERNAME](https://github.com/YOUR_USERNAME)
- Issues: [GitHub Issues](https://github.com/YOUR_USERNAME/xdirex/issues)

## ğŸ™ Acknowledgments

- Cloudflare Workers/Pages for infrastructure
- Google OAuth for authentication
- Lucide icons for UI icons

---

**Built with â¤ï¸ using Cloudflare Stack**
